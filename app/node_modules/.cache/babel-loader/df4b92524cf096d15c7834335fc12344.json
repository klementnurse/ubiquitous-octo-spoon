{"ast":null,"code":"import _regeneratorRuntime from \"/Users/matthew/Desktop/optizmo/webapp/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/matthew/Desktop/optizmo/webapp/app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport axios from 'axios';\nimport merge from 'lodash.merge';\nimport { generateDefaultPageData } from '../utils';\nexport var submitOptout = /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(campaignId, request) {\n    var res;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return axios.post(\"/campaigns/\".concat(campaignId, \"/optout-emails\"), request);\n\n          case 2:\n            res = _context.sent;\n            return _context.abrupt(\"return\", res.data);\n\n          case 4:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function submitOptout(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport var fetchPageData = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(campaignId, optoutType) {\n    var defaultData, _response$data$logo, _response$data$redire, _response$data$redire2, _response$data$confir, _response$data$confir2, _response$data$landin, _response$data$landin2, _response$data$landin3, _response$data$privac, _response$data$privac2, response, responseData, data, axiosError, status;\n\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            defaultData = generateDefaultPageData(optoutType);\n            _context2.prev = 1;\n            _context2.next = 4;\n            return axios.get(\"/campaigns/\".concat(campaignId, \"/optout-page\"));\n\n          case 4:\n            response = _context2.sent;\n            // Transform data to frontend contract.\n            responseData = {\n              style: response.data.style,\n              logo: (_response$data$logo = response.data.logo) !== null && _response$data$logo !== void 0 ? _response$data$logo : undefined,\n              redirect: {\n                url: (_response$data$redire = response.data.redirect.url) !== null && _response$data$redire !== void 0 ? _response$data$redire : undefined,\n                appendEmail: (_response$data$redire2 = response.data.redirect.append_email) !== null && _response$data$redire2 !== void 0 ? _response$data$redire2 : undefined\n              },\n              confirmation: {\n                title: (_response$data$confir = response.data.confirmation.title) !== null && _response$data$confir !== void 0 ? _response$data$confir : undefined,\n                content: (_response$data$confir2 = response.data.confirmation.content) !== null && _response$data$confir2 !== void 0 ? _response$data$confir2 : undefined\n              },\n              landing: {\n                title: (_response$data$landin = response.data.landing.title) !== null && _response$data$landin !== void 0 ? _response$data$landin : undefined,\n                content: (_response$data$landin2 = response.data.landing.content) !== null && _response$data$landin2 !== void 0 ? _response$data$landin2 : undefined,\n                contentBelowEmail: (_response$data$landin3 = response.data.landing.contentBelowEmail) !== null && _response$data$landin3 !== void 0 ? _response$data$landin3 : undefined\n              },\n              privacy: {\n                url: (_response$data$privac = response.data.privacy.url) !== null && _response$data$privac !== void 0 ? _response$data$privac : undefined,\n                content: (_response$data$privac2 = response.data.privacy.url) !== null && _response$data$privac2 !== void 0 ? _response$data$privac2 : undefined\n              },\n              preference: response.data.preference\n            };\n            data = merge(defaultData, responseData);\n            return _context2.abrupt(\"return\", data);\n\n          case 10:\n            _context2.prev = 10;\n            _context2.t0 = _context2[\"catch\"](1);\n            axiosError = _context2.t0;\n            status = axiosError.response ? axiosError.response.status : null;\n\n            if (!(status && status >= 400 && status < 500)) {\n              _context2.next = 16;\n              break;\n            }\n\n            throw axiosError;\n\n          case 16:\n            return _context2.abrupt(\"return\", defaultData);\n\n          case 17:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2, null, [[1, 10]]);\n  }));\n\n  return function fetchPageData(_x3, _x4) {\n    return _ref2.apply(this, arguments);\n  };\n}();","map":{"version":3,"sources":["/Users/matthew/Desktop/optizmo/webapp/app/src/services/optout.ts"],"names":["axios","merge","generateDefaultPageData","submitOptout","campaignId","request","post","res","data","fetchPageData","optoutType","defaultData","get","response","responseData","style","logo","undefined","redirect","url","appendEmail","append_email","confirmation","title","content","landing","contentBelowEmail","privacy","preference","axiosError","status"],"mappings":"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","sourcesContent":["import axios, { AxiosError } from 'axios'\nimport merge from 'lodash.merge'\nimport {\n  OptoutType,\n  OptoutPageResponse,\n  SubmitEmailRequest\n} from '../contracts'\nimport { PageData } from '../contracts/page-data'\nimport { generateDefaultPageData } from '../utils'\n\nexport const submitOptout = async (\n  campaignId: number,\n  request: SubmitEmailRequest\n) => {\n  const res = await axios.post<void>(\n    `/campaigns/${campaignId}/optout-emails`,\n    request\n  )\n\n  return res.data\n}\n\nexport const fetchPageData = async (\n  campaignId: number,\n  optoutType: OptoutType\n): Promise<PageData> => {\n  const defaultData = generateDefaultPageData(optoutType)\n\n  try {\n    const response = await axios.get<OptoutPageResponse>(\n      `/campaigns/${campaignId}/optout-page`\n    )\n    // Transform data to frontend contract.\n    const responseData: PageData = {\n      style: response.data.style,\n      logo: response.data.logo ?? undefined,\n      redirect: {\n        url: response.data.redirect.url ?? undefined,\n        appendEmail: response.data.redirect.append_email ?? undefined\n      },\n      confirmation: {\n        title: response.data.confirmation.title ?? undefined,\n        content: response.data.confirmation.content ?? undefined\n      },\n      landing: {\n        title: response.data.landing.title ?? undefined,\n        content: response.data.landing.content ?? undefined,\n        contentBelowEmail: response.data.landing.contentBelowEmail ?? undefined\n      },\n      privacy: {\n        url: response.data.privacy.url ?? undefined,\n        content: response.data.privacy.url ?? undefined\n      },\n      preference: response.data.preference\n    }\n    const data = merge(defaultData, responseData)\n\n    return data\n  } catch (error) {\n    const axiosError = error as AxiosError\n    const status = axiosError.response ? axiosError.response.status : null\n\n    if (status && status >= 400 && status < 500) {\n      throw axiosError\n    }\n\n    // All other errors will fallback to returning default PageData.\n  }\n\n  return defaultData\n}\n"]},"metadata":{},"sourceType":"module"}